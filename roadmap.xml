<?xml version="1.0" encoding="UTF-8"?>
<roadmap>
  <project>
    <name>pysof PyPI Release Improvements</name>
    <description>Enhance PyPI package presentation and fix configuration issues</description>
    <created>2025-01-11</created>
  </project>

  <current-state>
    <status>✅ Complete - Ready for v0.1.26 Release</status>
    <summary>
      All critical issues have been resolved:
      - ✅ Automatic version sync from Cargo.toml (using dynamic = ["version"])
      - ✅ Project URLs properly configured (will display after v0.1.26 publish)
      - ✅ README optimized for PyPI with "Why pysof?" section
      - ✅ Python minimum version raised to 3.10 (matches code syntax)
      - ✅ Build tested and working (pysof-0.1.26 wheel created successfully)
    </summary>
    
    <completed-items>
      <item id="1">
        <title>Initial PyPI Publication</title>
        <description>Successfully published pysof v0.1.25 to PyPI manually using twine</description>
        <status>✅ Complete</status>
      </item>
      <item id="2">
        <title>CI/CD Wheel Building</title>
        <description>CI workflow builds wheels for Linux, Windows, macOS on tags</description>
        <status>✅ Complete</status>
        <details>
          - Build job runs on version tags (refs/tags/v*)
          - Matrix strategy for multiple platforms
          - Wheels uploaded as artifacts
        </details>
      </item>
      <item id="3">
        <title>Automated PyPI Upload in CI</title>
        <description>publish-pypi job uploads to PyPI using PYPI_API_TOKEN</description>
        <status>✅ Complete</status>
        <details>
          - Uses twine for upload
          - --skip-existing flag to avoid conflicts
          - Runs only on version tags
        </details>
      </item>
      <item id="4">
        <title>Enhanced README Documentation</title>
        <description>Comprehensive README with badges, examples, and documentation</description>
        <status>✅ Complete</status>
        <details>
          - PyPI badge, version badge, license badge
          - Quick links section
          - Installation instructions
          - Usage examples
          - Performance documentation
        </details>
      </item>
      <item id="5">
        <title>Post-Release URL Fix</title>
        <description>Commit 654a25e updated project URLs to be pysof-specific</description>
        <status>✅ Complete</status>
        <note>Changes made after v0.1.25 release, will apply to next release</note>
      </item>
      <item id="6">
        <title>Automatic Version Synchronization</title>
        <description>Implemented dynamic version reading from Cargo.toml</description>
        <status>✅ Complete</status>
        <details>
          - Added dynamic = ["version"] to pyproject.toml
          - Maturin now reads version from Cargo.toml automatically
          - Single source of truth for version numbers
        </details>
      </item>
      <item id="7">
        <title>Python Version Requirement Update</title>
        <description>Raised minimum Python version to 3.10 to match code syntax</description>
        <status>✅ Complete</status>
        <details>
          - Updated requires-python to >=3.10
          - Updated mypy and ruff configurations
          - Updated README documentation
          - Fixes X | Y union syntax errors
        </details>
      </item>
      <item id="8">
        <title>README PyPI Optimization</title>
        <description>Enhanced README for better PyPI presentation</description>
        <status>✅ Complete</status>
        <details>
          - Improved title: "pysof - SQL on FHIR for Python"
          - Added SQL on FHIR specification link
          - Added "Why pysof?" value proposition section
          - Better project context explanation
        </details>
      </item>
      <item id="9">
        <title>Rust Toolchain Update</title>
        <description>Updated rustc from 1.89.0 to 1.91.1</description>
        <status>✅ Complete</status>
      </item>
      <item id="10">
        <title>Successful Build Verification</title>
        <description>Verified pysof-0.1.26 wheel builds correctly on Windows</description>
        <status>✅ Complete</status>
      </item>
    </completed-items>
  </current-state>

  <issues-resolved>
    <issue id="1" priority="high" status="✅ RESOLVED">
      <title>Version Number Mismatch</title>
      <solution>
        Implemented automatic version reading using dynamic = ["version"] in pyproject.toml.
        Maturin now reads version directly from Cargo.toml workspace version.
        Single source of truth eliminates possibility of version drift.
      </solution>
      <resolution-date>2025-01-11</resolution-date>
    </issue>

    <issue id="2" priority="medium" status="✅ RESOLVED">
      <title>Project URLs Not Displaying on PyPI</title>
      <solution>
        Root cause identified: URLs were updated in commit 654a25e after v0.1.25 release.
        URL format is correct per PEP 621 specification.
        URLs will display correctly when v0.1.26 is published to PyPI.
      </solution>
      <resolution-date>2025-01-11</resolution-date>
    </issue>

    <issue id="3" priority="medium" status="✅ RESOLVED">
      <title>README Optimization for PyPI</title>
      <solution>
        - Enhanced title: "pysof - SQL on FHIR for Python"
        - Added SQL on FHIR specification link
        - Added "Why pysof?" section explaining value proposition
        - Improved project context and description
      </solution>
      <resolution-date>2025-01-11</resolution-date>
    </issue>

    <issue id="4" priority="low" status="✅ RESOLVED">
      <title>GitHub vs PyPI Link Strategy</title>
      <solution>
        URLs now follow a focused strategy (per commit 654a25e):
        - Homepage/Source/Documentation: Point to crates/pysof subdirectory
        - Repository: Points to HFS root (provides broader context)
        - Bug Tracker: Points to HFS issues (shared tracker)
        This provides good balance between focused landing page and project context.
      </solution>
      <resolution-date>2025-01-11</resolution-date>
    </issue>

    <issue id="5" priority="high" status="✅ RESOLVED">
      <title>Python Version Compatibility (New Issue Found)</title>
      <solution>
        Code used Python 3.10+ syntax (X | Y unions) but claimed 3.8+ support.
        Updated minimum Python requirement to 3.10 in:
        - pyproject.toml (requires-python, classifiers)
        - mypy configuration (python_version)
        - ruff configuration (target-version)
        - README.md documentation
      </solution>
      <resolution-date>2025-01-11</resolution-date>
    </issue>
  </issues-resolved>

  <roadmap-phases-completed>
    <phase id="1" priority="critical" status="✅ COMPLETE">
      <name>Version Synchronization</name>
      <completion-date>2025-01-11</completion-date>
      <summary>Implemented automatic version sync using dynamic = ["version"]</summary>
    </phase>

    <phase id="2" priority="high" status="✅ COMPLETE">
      <name>Fix PyPI Project URLs</name>
      <completion-date>2025-01-11</completion-date>
      <summary>URLs verified as correct, will display after v0.1.26 publish</summary>
    </phase>

    <phase id="3" priority="medium" status="✅ COMPLETE">
      <name>Enhance README for PyPI</name>
      <completion-date>2025-01-11</completion-date>
      <summary>README optimized with better title, description, and value proposition</summary>
    </phase>

    <phase id="4" priority="medium" status="✅ COMPLETE">
      <name>Standardize Link Strategy</name>
      <completion-date>2025-01-11</completion-date>
      <summary>Link strategy established and implemented in commit 654a25e</summary>
    </phase>

    <phase id="5" priority="high" status="⚠️ PARTIAL">
      <name>Test PyPI Installation</name>
      <completion-date>N/A</completion-date>
      <summary>Build verified locally, full PyPI testing pending after v0.1.26 publish</summary>
    </phase>

    <phase id="6" priority="low" status="✅ COMPLETE">
      <name>CI/CD Enhancements</name>
      <completion-date>2025-01-11</completion-date>
      <summary>CI/CD pipeline confirmed working, builds wheels successfully</summary>
    </phase>
  </roadmap-phases-completed>

  <future-enhancements>
    <enhancement priority="low">
      <title>Add CI Version Validation Check</title>
      <description>Add job to verify version consistency (though now automated via dynamic)</description>
    </enhancement>
    <enhancement priority="low">
      <title>Add PyPI Upload Verification</title>
      <description>Verify package is accessible after upload completes</description>
    </enhancement>
    <enhancement priority="low">
      <title>Integration Tests for PyPI Packages</title>
      <description>Add CI job that installs from TestPyPI and runs smoke tests</description>
    </enhancement>
  </future-enhancements>

  <technical-summary>
    <configuration>
      <item>Format: PEP 621 compliant pyproject.toml</item>
      <item>Build backend: maturin >=1.9.5</item>
      <item>Python support: 3.10, 3.11, 3.12, 3.13</item>
      <item>Version: 0.1.26 (auto-synced from Cargo.toml via dynamic)</item>
      <item>Rust version: 1.91.1</item>
    </configuration>
    
    <ci-pipeline>
      <item>Location: .github/workflows/ci.yml</item>
      <item>Build: Multi-platform (Linux, Windows, macOS)</item>
      <item>Trigger: Version tags (v*)</item>
      <item>Publish: Automatic to PyPI using twine</item>
      <item>Status: ✅ Working and verified</item>
    </ci-pipeline>
  </technical-summary>

  <next-actions>
    <immediate>
      <action priority="1" status="READY">Create v0.1.26 tag and trigger release</action>
      <action priority="2" status="READY">Verify PyPI page after publish (check URLs display)</action>
      <action priority="3" status="PENDING">Test installation from PyPI with basic example</action>
    </immediate>
    
    <future>
      <action>Add integration tests for PyPI installations</action>
      <action>Create pysof-specific documentation site</action>
      <action>Add CI version validation check (optional, now automated)</action>
    </future>
  </next-actions>

  <references>
    <reference>
      <title>PyPI Project Page</title>
      <url>https://pypi.org/project/pysof/</url>
    </reference>
    <reference>
      <title>Post-Release URL Fix Commit</title>
      <url>https://github.com/HeliosSoftware/hfs/commit/654a25ed26ddf3357c58d14e6c04e8104a22869e</url>
    </reference>
    <reference>
      <title>PEP 621 - Project Metadata</title>
      <url>https://peps.python.org/pep-0621/</url>
    </reference>
    <reference>
      <title>NumPy PyPI Example</title>
      <url>https://pypi.org/project/numpy/</url>
    </reference>
    <reference>
      <title>Maturin Documentation</title>
      <url>https://www.maturin.rs/</url>
    </reference>
  </references>
</roadmap>
