<?xml version="1.0" encoding="UTF-8"?>
<roadmap>
  <project>
    <name>pysof PyPI Release Improvements</name>
    <description>Enhance PyPI package presentation and fix configuration issues</description>
    <created>2025-01-11</created>
  </project>

  <current-state>
    <status>Partially Complete</status>
    <summary>
      First successful PyPI release completed (v0.1.25), but several improvements needed:
      - Version mismatch between pyproject.toml (0.1.25) and Cargo.toml (0.1.26)
      - Project URLs not appearing on PyPI page
      - README could be optimized for PyPI presentation
      - Links point to root HFS repo instead of pysof subdirectory
    </summary>
    
    <completed-items>
      <item id="1">
        <title>Initial PyPI Publication</title>
        <description>Successfully published pysof v0.1.25 to PyPI manually using twine</description>
        <status>✅ Complete</status>
      </item>
      <item id="2">
        <title>CI/CD Wheel Building</title>
        <description>CI workflow builds wheels for Linux, Windows, macOS on tags</description>
        <status>✅ Complete</status>
        <details>
          - Build job runs on version tags (refs/tags/v*)
          - Matrix strategy for multiple platforms
          - Wheels uploaded as artifacts
        </details>
      </item>
      <item id="3">
        <title>Automated PyPI Upload in CI</title>
        <description>publish-pypi job uploads to PyPI using PYPI_API_TOKEN</description>
        <status>✅ Complete</status>
        <details>
          - Uses twine for upload
          - --skip-existing flag to avoid conflicts
          - Runs only on version tags
        </details>
      </item>
      <item id="4">
        <title>Enhanced README Documentation</title>
        <description>Comprehensive README with badges, examples, and documentation</description>
        <status>✅ Complete</status>
        <details>
          - PyPI badge, version badge, license badge
          - Quick links section
          - Installation instructions
          - Usage examples
          - Performance documentation
        </details>
      </item>
      <item id="5">
        <title>Post-Release URL Fix</title>
        <description>Commit 654a25e updated project URLs to be pysof-specific</description>
        <status>✅ Complete</status>
        <note>Changes made after v0.1.25 release, will apply to next release</note>
      </item>
    </completed-items>
  </current-state>

  <issues>
    <issue id="1" priority="high">
      <title>Version Number Mismatch</title>
      <description>
        pyproject.toml has version = "0.1.25" but workspace Cargo.toml has version = "0.1.26"
        These should be synchronized.
      </description>
      <impact>Confusion, potential build issues, version tracking problems</impact>
      <affected-files>
        <file>crates/pysof/pyproject.toml</file>
        <file>Cargo.toml (workspace)</file>
      </affected-files>
    </issue>

    <issue id="2" priority="medium">
      <title>Project URLs Not Displaying on PyPI</title>
      <description>
        pyproject.toml has [project.urls] section but links don't appear on PyPI page.
        Expected: Homepage, Source, Documentation, Bug Tracker links on left sidebar.
        Actual: Links missing from PyPI page.
      </description>
      <investigation-needed>
        - Check if PyPI requires specific URL key names
        - Verify pyproject.toml format matches PEP 621
        - Compare with working examples (e.g., numpy)
      </investigation-needed>
      <affected-files>
        <file>crates/pysof/pyproject.toml</file>
      </affected-files>
    </issue>

    <issue id="3" priority="medium">
      <title>README Optimization for PyPI</title>
      <description>
        While README is comprehensive, it could be optimized for PyPI presentation:
        - Consider adding more visual elements
        - Ensure proper rendering of Markdown on PyPI
        - Optimize structure for quick scanning
      </description>
      <affected-files>
        <file>crates/pysof/README.md</file>
      </affected-files>
    </issue>

    <issue id="4" priority="low">
      <title>GitHub vs PyPI Link Strategy</title>
      <description>
        Some links point to root HFS repo, others to pysof subdirectory.
        Need consistent strategy for where users should land.
      </description>
      <consideration>
        Should PyPI users be directed to:
        - Main HFS repository (broader context)
        - Directly to crates/pysof (focused documentation)
        Current state: Mixed approach after commit 654a25e
      </consideration>
    </issue>
  </issues>

  <roadmap-phases>
    <phase id="1" priority="critical">
      <name>Version Synchronization</name>
      <tasks>
        <task id="1.1" status="pending">
          <title>Sync pyproject.toml version with workspace version</title>
          <action>Update pyproject.toml version from 0.1.25 to 0.1.26</action>
          <rationale>Maintain single source of truth for version numbers</rationale>
        </task>
        <task id="1.2" status="pending">
          <title>Document version management strategy</title>
          <action>Add comment or documentation about keeping versions in sync</action>
        </task>
        <task id="1.3" status="pending">
          <title>Consider automation</title>
          <action>Explore auto-syncing versions in CI or using cargo-release</action>
        </task>
      </tasks>
    </phase>

    <phase id="2" priority="high">
      <name>Fix PyPI Project URLs</name>
      <tasks>
        <task id="2.1" status="pending">
          <title>Research PyPI URL requirements</title>
          <action>Check PEP 621 and PyPI documentation for correct URL key names</action>
          <reference>https://packaging.python.org/specifications/declaring-project-metadata/</reference>
        </task>
        <task id="2.2" status="pending">
          <title>Update pyproject.toml URL keys</title>
          <action>Use standard keys: Homepage, Source, Documentation, Bug Tracker, etc.</action>
          <note>Current keys may not match PyPI expectations</note>
        </task>
        <task id="2.3" status="pending">
          <title>Verify URL format</title>
          <action>Ensure URLs are correct after commit 654a25e changes</action>
        </task>
        <task id="2.4" status="pending">
          <title>Test with next release</title>
          <action>Publish new version and verify URLs appear correctly</action>
        </task>
      </tasks>
    </phase>

    <phase id="3" priority="medium">
      <name>Enhance README for PyPI</name>
      <tasks>
        <task id="3.1" status="pending">
          <title>Review numpy and other popular packages</title>
          <action>Study README structure of well-presented PyPI packages</action>
        </task>
        <task id="3.2" status="pending">
          <title>Optimize quick start section</title>
          <action>Ensure most important information is above the fold</action>
        </task>
        <task id="3.3" status="pending">
          <title>Add visual elements</title>
          <action>Consider adding diagrams, workflow illustrations if helpful</action>
        </task>
        <task id="3.4" status="pending">
          <title>Test Markdown rendering</title>
          <action>Verify all Markdown features render correctly on PyPI</action>
        </task>
      </tasks>
    </phase>

    <phase id="4" priority="medium">
      <name>Standardize Link Strategy</name>
      <tasks>
        <task id="4.1" status="pending">
          <title>Define link strategy</title>
          <action>Decide whether to prioritize HFS repo or pysof subdirectory</action>
          <options>
            - Homepage: pysof directory (focused)
            - Repository: HFS root (context)
            - Documentation: pysof directory (specific)
            - Bug Tracker: HFS issues (shared)
          </options>
        </task>
        <task id="4.2" status="pending">
          <title>Update all references consistently</title>
          <action>Apply link strategy across pyproject.toml, README.md, and code</action>
        </task>
      </tasks>
    </phase>

    <phase id="5" priority="high">
      <name>Test PyPI Installation</name>
      <tasks>
        <task id="5.1" status="pending">
          <title>Install pysof from PyPI in clean environment</title>
          <action>pip install pysof in fresh virtual environment</action>
        </task>
        <task id="5.2" status="pending">
          <title>Run basic example from README</title>
          <action>Test the Quick Start example to ensure it works</action>
        </task>
        <task id="5.3" status="pending">
          <title>Verify wheel compatibility</title>
          <action>Test on different platforms (Linux, Windows, macOS) if possible</action>
        </task>
        <task id="5.4" status="pending">
          <title>Check import and basic functions</title>
          <action>Verify module imports and core functions work correctly</action>
        </task>
      </tasks>
    </phase>

    <phase id="6" priority="low">
      <name>CI/CD Enhancements</name>
      <tasks>
        <task id="6.1" status="complete">
          <title>Automated wheel building</title>
          <action>Already implemented in ci.yml build job</action>
        </task>
        <task id="6.2" status="complete">
          <title>Automated PyPI publishing</title>
          <action>Already implemented in ci.yml publish-pypi job</action>
        </task>
        <task id="6.3" status="pending">
          <title>Add version validation</title>
          <action>CI check to ensure pyproject.toml and Cargo.toml versions match</action>
        </task>
        <task id="6.4" status="pending">
          <title>Add PyPI upload verification</title>
          <action>Verify package is accessible after upload completes</action>
        </task>
      </tasks>
    </phase>
  </roadmap-phases>

  <technical-notes>
    <note category="pyproject.toml">
      <title>Current Configuration</title>
      <content>
        - Format: PEP 621 compliant
        - Build backend: maturin
        - Python support: 3.8-3.13
        - Version: 0.1.25 (should be 0.1.26)
        - URLs defined but not appearing on PyPI
      </content>
    </note>

    <note category="ci-workflow">
      <title>Build and Publish Pipeline</title>
      <content>
        Location: .github/workflows/ci.yml
        
        Build job (lines 522-632):
        - Runs on: Linux, Windows, macOS
        - Triggers: On version tags (v*)
        - Builds wheels with: uv run maturin build --release
        - Linux also builds sdist: --sdist flag
        - Uploads artifacts: pysof-{target}
        
        Publish job (lines 633-657):
        - Runs on: Linux
        - Downloads all pysof-* artifacts
        - Uses twine to upload
        - Token: secrets.PYPI_API_TOKEN
        - Flag: --skip-existing
      </content>
    </note>

    <note category="version-management">
      <title>Version Sources</title>
      <content>
        1. Cargo.toml (workspace): version = "0.1.26"
        2. crates/pysof/Cargo.toml: version.workspace = true (inherits 0.1.26)
        3. crates/pysof/pyproject.toml: version = "0.1.25" (MISMATCH!)
        
        The pyproject.toml version is used by maturin for wheel metadata.
        This is what appears on PyPI.
      </content>
    </note>

    <note category="urls">
      <title>URL Investigation</title>
      <content>
        Current pyproject.toml [project.urls] section:
        - Homepage = "https://github.com/HeliosSoftware/hfs/tree/main/crates/pysof"
        - Repository = "https://github.com/HeliosSoftware/hfs"
        - Documentation = "https://github.com/HeliosSoftware/hfs/tree/main/crates/pysof"
        - "Bug Tracker" = "https://github.com/HeliosSoftware/hfs/issues"
        - Source = "https://github.com/HeliosSoftware/hfs/tree/main/crates/pysof"
        
        PyPI may expect specific key names or format.
        Need to verify against PEP 621 specification.
      </content>
    </note>
  </technical-notes>

  <next-actions>
    <immediate>
      <action priority="1">Update pyproject.toml version to 0.1.26</action>
      <action priority="2">Research and fix project URLs for PyPI display</action>
      <action priority="3">Test pysof installation from PyPI with basic example</action>
    </immediate>
    
    <short-term>
      <action>Review README for PyPI optimization opportunities</action>
      <action>Add CI check for version synchronization</action>
      <action>Document version management process</action>
    </short-term>
    
    <long-term>
      <action>Consider automating version bumps</action>
      <action>Add integration tests for PyPI installations</action>
      <action>Create pysof-specific documentation site</action>
    </long-term>
  </next-actions>

  <references>
    <reference>
      <title>PyPI Project Page</title>
      <url>https://pypi.org/project/pysof/</url>
    </reference>
    <reference>
      <title>Post-Release URL Fix Commit</title>
      <url>https://github.com/HeliosSoftware/hfs/commit/654a25ed26ddf3357c58d14e6c04e8104a22869e</url>
    </reference>
    <reference>
      <title>PEP 621 - Project Metadata</title>
      <url>https://peps.python.org/pep-0621/</url>
    </reference>
    <reference>
      <title>NumPy PyPI Example</title>
      <url>https://pypi.org/project/numpy/</url>
    </reference>
    <reference>
      <title>Maturin Documentation</title>
      <url>https://www.maturin.rs/</url>
    </reference>
  </references>
</roadmap>
